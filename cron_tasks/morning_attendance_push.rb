# ============================================
# cron_tasks/morning_attendance_push.rb
# 매일 다른 질문으로 출석 독려 (200개 질문 랜덤)
# ============================================
require_relative '../utils/professor_control'
require 'date'

# 200개의 질문 리스트 (해리포터 세계관 고학년용)
ATTENDANCE_QUESTIONS = [
  # 학업 및 시험 관련
  "Q. 가장 어려운 과목은 무엇인가요?",
  "Q. 오늘 예습할 과목이 있나요?",
  "Q. 최근 마법 이론 수업에서 배운 것 중 흥미로운 게 있었나요?",
  "Q. 시험 기간에 주로 어디서 공부하나요?",
  "Q. 변신술과 마법 약 중 어느 것이 더 재미있나요?",
  "Q. 실기 시험과 이론 시험 중 어느 쪽이 더 자신 있나요?",
  "Q. 졸업 후 어떤 분야로 진출하고 싶나요?",
  "Q. 고급 마법 주문 중 가장 배우고 싶은 건 무엇인가요?",
  "Q. 마법부에서 일하고 싶은 생각이 있나요?",
  "Q. 졸업 후 바로 취업할 건가요, 아니면 더 공부할 건가요?",
  "Q. 어떤 직업 마법사가 되고 싶나요?",
  "Q. 해외 마법 학교에 교환학생 가고 싶나요?",
  "Q. 마법 생물 관련 일에 관심 있나요?",
  "Q. 연구직과 실무직 중 어느 쪽이 더 끌리나요?",
  "Q. 자신만의 가게를 운영하고 싶은 적 있나요?",
  "Q. 마법 교육자가 되는 건 어떨까요?",
  "Q. 국제 마법 협력 업무에 관심 있나요?",
  "Q. 치료사의 길을 고려해본 적 있나요?",
  "Q. 가장 자신 있는 마법 주문은 무엇인가요?",
  "Q. 어둠의 마법 방어술 실력은 어느 정도인가요?",
  "Q. 가장 어려웠던 마법은 무엇이었나요?",
  "Q. 최근에 새로 배운 주문이 있나요?",
  "Q. 기숙사 생활 중 가장 좋은 점은 무엇인가요?",
  "Q. 기숙사 점수 경쟁에 대해 어떻게 생각하나요?",
  "Q. 기숙사 파티에 참여한 적 있나요?",
  "Q. 기숙사 휴게실에서 주로 무엇을 하나요?",
  "Q. 다른 기숙사 친구들도 있나요?",
  "Q. 기숙사 전통 중 가장 좋아하는 게 있나요?",
  "Q. 야간 통금은 잘 지키고 있나요?",
  "Q. 기숙사 대항전에서 어떤 역할을 맡고 싶나요?",
  "Q. 기숙사 우승 트로피를 본 적 있나요?",
  "Q. 다른 학년 친구들도 사귀고 있나요?",
  "Q. 스터디 그룹에 참여하고 있나요?",
  "Q. 주말에 친구들과 주로 무엇을 하나요?",
  "Q. 가장 기억에 남는 친구와의 추억은?",
  "Q. 친구들과 비밀 아지트가 있나요?",
  "Q. 후배들에게 조언해줄 말이 있나요?",
  "Q. 졸업 후에도 계속 연락할 친구가 있나요?",
  "Q. 무도회에 가본 적 있나요?",
  "Q. 짝사랑하는 사람이 있나요?",
  "Q. 발렌타인데이는 어떻게 보내나요?",
  "Q. 이상형은 어떤 사람인가요?",
  "Q. 데이트 장소로 어디가 좋을까요?",
  "Q. 첫눈에 반한 적 있나요?",
  "Q. 고백은 받아본 적 있나요?",
  "Q. 연애와 학업, 균형을 맞추기 어렵나요?",
  "Q. 졸업 전에 꼭 이루고 싶은 연애 목표가 있나요?",
  "Q. 퀴디치 경기는 자주 보러 가나요?",
  "Q. 퀴디치 선수가 되고 싶었던 적 있나요?",
  "Q. 마법사 체스 실력은 어떤가요?",
  "Q. 최근에 읽은 예언자 일보 기사 중 기억나는 게 있나요?",
  "Q. 마법 사진은 몇 장이나 가지고 있나요?",
  "Q. 부엉이 우편을 자주 받나요?",
  "Q. 마법 세계 뉴스를 챙겨보나요?",
  "Q. 도서관에서 얼마나 자주 공부하나요?",
  "Q. 금서 구역에 가본 적 있나요?",
  "Q. 가장 재미있게 읽은 마법서는?",
  "Q. 밤샘 공부를 자주 하나요?",
  "Q. 도서관 사서와 친한가요?",
  "Q. 조용한 곳과 시끄러운 곳 중 어디서 공부가 잘 되나요?",
  "Q. 노트 필기는 손으로 하나요, 마법으로 하나요?",
  "Q. 교과서 외에 개인적으로 공부하는 분야가 있나요?",
  "Q. 고대 룬 문자를 읽을 수 있나요?",
  "Q. 마법사 역사에 관심이 많나요?",
  "Q. 대연회장 음식 중 가장 좋아하는 건?",
  "Q. 버터 맥주는 자주 마시나요?",
  "Q. 호그와트 주방에 가본 적 있나요?",
  "Q. 집요정들과 이야기해본 적 있나요?",
  "Q. 가장 좋아하는 간식은 무엇인가요?",
  "Q. 자정 간식을 몰래 먹은 적 있나요?",
  "Q. 특별한 날 대연회장 장식을 좋아하나요?",
  "Q. 호그와트 음식과 집 음식 중 어느 게 더 맛있나요?",
  "Q. 마법 사탕을 자주 먹나요?",
  "Q. 특이한 맛 젤리빈을 먹어본 적 있나요?",
  "Q. 가장 좋아하는 마법 생물은 무엇인가요?",
  "Q. 펫으로 무엇을 키우고 있나요?",
  "Q. 금지된 숲에 가보고 싶나요?",
  "Q. 마법 생물 돌보기 수업을 듣고 있나요?",
  "Q. 가장 무서웠던 마법 생물은?",
  "Q. 마법 약 제조 실력은 어떤가요?",
  "Q. 가장 어려운 마법 약은 무엇이었나요?",
  "Q. 행운의 물약을 마셔본다면 무엇을 하고 싶나요?",
  "Q. 마법 약 재료는 직접 준비하나요?",
  "Q. 실험 중 실패한 적 있나요?",
  "Q. 새로운 마법 약을 개발하고 싶나요?",
  "Q. 마법 약 교과서를 다 읽었나요?",
  "Q. 해독제 만들기는 자신 있나요?",
  "Q. 치유 물약 중 가장 중요한 건 무엇일까요?",
  "Q. 점술 수업을 듣고 있나요?",
  "Q. 자신의 미래를 보고 싶나요?",
  "Q. 차 잎 점을 믿나요?",
  "Q. 수정구를 들여다본 적 있나요?",
  "Q. 꿈 해석에 관심이 있나요?",
  "Q. 운명을 믿나요, 아니면 노력을 믿나요?",
  "Q. 별자리에 대해 잘 아나요?",
  "Q. 예언에 대해 어떻게 생각하나요?",
  "Q. 타로 카드를 본 적 있나요?",
  "Q. 미래의 나에게 편지를 쓴다면?",
  "Q. 방학 때 무엇을 하고 싶나요?",
  "Q. 여름 방학 계획이 있나요?",
  "Q. 학교에 남을 건가요, 집에 갈 건가요?",
  "Q. 방학 숙제는 미리 하는 편인가요?",
  "Q. 크리스마스는 어떻게 보낼 건가요?",
  "Q. 방학 때 여행 가고 싶은 곳이 있나요?",
  "Q. 방학 중에도 친구들과 연락하나요?",
  "Q. 개학이 기다려지나요, 아니면 더 쉬고 싶나요?",
  "Q. 방학 중 특별한 경험을 한 적 있나요?",
  "Q. 방학 때 마법 실력을 더 키우나요?",
  "Q. 요즘 기분은 어떤가요?",
  "Q. 스트레스를 받을 때 어떻게 푸나요?",
  "Q. 가장 행복했던 순간은 언제인가요?",
  "Q. 지금 가장 걱정되는 게 있나요?",
  "Q. 누군가에게 조언을 구하고 싶은 게 있나요?",
  "Q. 최근에 감동받은 일이 있나요?",
  "Q. 힘들 때 위로가 되는 건 무엇인가요?",
  "Q. 가장 자랑스러웠던 순간은?",
  "Q. 후회하는 일이 있나요?",
  "Q. 마음이 편안해지는 장소가 있나요?",
  "Q. 여가 시간에 주로 무엇을 하나요?",
  "Q. 특별한 취미가 있나요?",
  "Q. 악기를 다룰 줄 아나요?",
  "Q. 그림이나 글쓰기를 좋아하나요?",
  "Q. 운동을 즐기나요?",
  "Q. 수집하는 게 있나요?",
  "Q. 요리에 관심이 있나요?",
  "Q. 밤하늘 관측을 좋아하나요?",
  "Q. 체스나 보드게임을 즐기나요?",
  "Q. 새로운 취미를 시작하고 싶나요?",
  "Q. 자신의 가장 큰 장점은 무엇인가요?",
  "Q. 고치고 싶은 단점이 있나요?",
  "Q. 용기와 지혜 중 무엇이 더 중요할까요?",
  "Q. 정의롭다는 건 무엇이라고 생각하나요?",
  "Q. 친구에게 가장 중요한 자질은?",
  "Q. 성공의 기준은 무엇이라고 생각하나요?",
  "Q. 어떤 사람으로 기억되고 싶나요?",
  "Q. 인생에서 가장 중요한 가치는?",
  "Q. 롤모델이 있나요?",
  "Q. 10년 후 자신의 모습은 어떨 것 같나요?",
  "Q. 호그와트에서 가장 좋아하는 장소는?",
  "Q. 천문대에 올라가본 적 있나요?",
  "Q. 온실에서 수업 듣는 걸 좋아하나요?",
  "Q. 계단들이 움직이는 게 불편하지 않나요?",
  "Q. 학교 유령들과 이야기한 적 있나요?",
  "Q. 초상화들과 친한가요?",
  "Q. 호수가에 자주 가나요?",
  "Q. 교장실에 가본 적 있나요?",
  "Q. 지금 계절이 마음에 드나요?",
  "Q. 비 오는 날 기분은 어떤가요?",
  "Q. 눈이 내리면 무엇을 하고 싶나요?",
  "Q. 가장 좋아하는 계절은?",
  "Q. 날씨가 공부에 영향을 주나요?",
  "Q. 맑은 날과 흐린 날 중 어느 쪽을 더 좋아하나요?",
  "Q. 천둥번개가 무섭나요?",
  "Q. 일출과 일몰 중 어느 것을 더 좋아하나요?",
  "Q. 달빛 아래 산책하는 걸 좋아하나요?",
  "Q. 계절의 변화를 느끼는 순간이 있나요?",
  "Q. 호그와트에서 가장 기억에 남는 순간은?",
  "Q. 입학 첫날이 기억나나요?",
  "Q. 배정 모자를 쓸 때 어땠나요?",
  "Q. 첫 마법 수업이 기억나나요?",
  "Q. 가장 웃겼던 일은 무엇이었나요?",
  "Q. 가장 놀랐던 경험은?",
  "Q. 잊지 못할 실수를 한 적 있나요?",
  "Q. 예상치 못한 성공을 거둔 적 있나요?",
  "Q. 학교에서 받은 상이나 표창이 있나요?",
  "Q. 졸업 후 가장 그리울 것 같은 게 무엇인가요?",
  "Q. 졸업 전 꼭 해보고 싶은 활동이 있나요?"
]

def run_morning_attendance_push(sheet_manager, mastodon_client)
  puts "[아침 출석] #{Time.now.strftime('%Y-%m-%d %H:%M:%S')} - 실행 시작"
  
  # 교수 시트에서 ON/OFF 확인
  enabled = ProfessorControl.auto_push_enabled?(sheet_manager, "아침출석자동툿")
  puts "[아침 출석] 기능 상태: #{enabled ? 'ON' : 'OFF'}"
  
  unless enabled
    puts "[스킵] 아침 출석 자동툿이 OFF 상태입니다."
    return
  end

  # 랜덤 질문 선택
  today_question = ATTENDANCE_QUESTIONS.sample
  
  # 출석 안내 메시지 생성
  attendance_message = <<~MSG
    금일 출석체크 돌입니다. 아래에 멘션을 달아주시면 2갈레온, 기숙사 점수 1점이 지급됩니다. [출석]을 대답 앞에 달아주세요. 22시까지 출석이 가능합니다.

    #{today_question}
  MSG

  puts "[아침 출석] 전송할 메시지: #{attendance_message.strip[0..100]}..."
  puts "[아침 출석] 선택된 질문: #{today_question}"
  
  begin
    mastodon_client.broadcast(attendance_message.strip)
    puts "[아침 출석] 전송 완료"
  rescue => e
    puts "[에러] 아침 출석 안내 전송 실패: #{e.message}"
    puts e.backtrace.first(3)
  end
end
