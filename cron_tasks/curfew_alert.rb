# cron_tasks/curfew_alert.rb

require_relative '../professor_control'
require_relative '../push_notifier'

def run_curfew_alert(sheet_manager, mastodon_client)
  # 교수 시트에서 푸시 여부 확인
  unless auto_push_enabled?(sheet_manager, "새벽 통금 알람")
    puts "[스킵] 새벽 통금 알람 기능이 OFF 상태입니다."
    return
  end

  # 통금 메시지 구성 (랜덤 가능)
CURFEW_MESSAGES = [
   "지금은 통금 시간이랍니다. 하루를 마무리하며 편안히 쉬는 시간이 되었어요.",
  "오늘도 수고 많았어요. 이제는 기숙사에서 조용히 휴식을 취해볼까요?",
  "늦은 밤에는 몸과 마음도 쉬어야 해요. 기숙사 방 안에서 편히 쉬세요.",
  "기숙사는 여러분을 위한 가장 안전한 공간입니다. 이제 돌아가 주세요.",
  "오늘 배운 것들을 정리하며 하루를 마무리하면 좋겠네요.",
  "늦게까지 깨어 있으면 내일 피곤하답니다. 푹 쉬어주세요.",
  "밤은 휴식의 시간입니다. 따뜻한 담요 덮고 좋은 꿈 꾸세요.",
  "기숙사 안에서 책 한 권 읽으며 오늘을 정리해보는 건 어떨까요?",
  "교수님들도 이제 하루를 마무리한답니다. 여러분도 휴식하세요.",
  "이 시간에는 마법도 쉬고 있어요. 여러분도 기숙사로 돌아가 주세요.",
  "무리하지 않아도 괜찮아요. 충분히 쉬는 것도 공부의 일부랍니다.",
  "기숙사 불은 곧 꺼질 예정이에요. 준비되었나요?",
  "여러분이 오늘 얼마나 노력했는지 잘 알고 있어요. 이제는 쉬어도 돼요.",
  "기숙사 안에서 친구들과 조용히 이야기 나누는 것도 좋겠네요.",
  "이 밤이 여러분에게 따뜻한 휴식을 가져다주길 바랍니다.",
  "교수는 늘 여러분의 안전과 안정을 먼저 생각한답니다. 기숙사로 돌아가 주세요.",
  "책상에 앉아 하루를 돌아보며 조용한 시간을 가져보면 좋겠어요.",
  "지금은 여러분만의 시간을 가질 때입니다. 방 안에서 편히 머물러 주세요.",
  "창밖이 어두워졌네요. 이제는 기숙사 창문을 닫고 하루를 마무리합시다.",
  "오늘도 좋은 하루였어요. 이제는 포근한 이불 속에서 쉽시다."
  ]

 message = CURFEW_MESSAGES.sample

  # 전체 사용자에게 푸시 (or 공지 계정으로 전송)
  PushNotifier.broadcast(mastodon_client, message)
end

